#create mzR header
tempMzml$mzR_header <- mzR::chromatogramHeader(tempMzml$mzR_object)
#create mzR chromatogram
tempMzml$mzR_chromatogram <- mzR::chromatograms(tempMzml$mzR_object)
#set function
mzml_mrm <- master_list$data$peakRegionFinal[[idx_metabolite]]$ms_header_id
#set new index
newStartIndex <- NA
#set new end
newEndIndex <- NA
#update start RT
master_list$data$peakRegionFinal[[idx_metabolite]]$peakStartIndex[which(master_list$data$peakRegionFinal[[idx_metabolite]]$sample_plate==idx_plate)] <- newStartIndex
#update end RT
master_list$data$peakRegionFinal[[idx_metabolite]]$peakEndIndex[which(master_list$data$peakRegionFinal[[idx_metabolite]]$sample_plate==idx_plate)] <- newEndIndex
}#idx plate
}#idx metabolite
master_list$data$peakRegionFinal %>% View()
#object for data for chromatogram
master_list$data$chromatogram <- list()
master_list$data$peakAreaMetabolite <- list()
master_list$data$timestamp <- list()
#idx_plate = master_list$project_details$plateList[1] #for testing
#for(idx_plate in master_list$project_details$plateList[1]){ #for testing
for(idx_plate in master_list$project_details$plateList){
print(idx_plate)
master_list$data$timestamp[[idx_plate]] <- list()
idx_mzML = master_list$data$mzR[[idx_plate]][8] #for testing loop
#for(idx_mzML in master_list$data$mzR[[idx_plate]][c(1:6, length(master_list$data$mzR[[idx_plate]]))]){ # for testing loop
for(idx_mzML in master_list$data$mzR[[idx_plate]]){
#create temp mzML object
tempMzml <- list()
#load mzml
tempMzml$mzR_object <- mzR::openMSfile(
filename = paste0(master_list$project_details$plateDirList[grepl(idx_plate, master_list$project_details$plateDirList)], "/", idx_mzML)
)
#create mzR header
tempMzml$mzR_header <- mzR::chromatogramHeader(tempMzml$mzR_object)
#create mzR chromatogram
tempMzml$mzR_chromatogram <- mzR::chromatograms(tempMzml$mzR_object)
#store sample timestamp
master_list$data$timestamp[[idx_plate]] <- bind_rows(
master_list$data$timestamp[[idx_plate]],
tibble(
samplePlate = idx_plate,
sampleName = idx_mzML,
sampleTimestamp = tempMzml$mzR_object@backend$getRunStartTimeStamp()
) %>%
add_column(.before = 1,
sampleID = paste0(.$samplePlate, "_", .$sampleName)
)
)
# extract peak region
#idx_mrm = "GCA-SIL_d4" # for testing loop
#idx_mrm ="TCA-SIL_d4"
for(idx_mrm in names(master_list$data$peakRegionFinal)){
#for(idx_mrm in c("GCA", "GCA-SIL_d4")){
#create list on first iteration of mrm
if(!idx_mrm %in% names(master_list$data$chromatogram)){master_list$data$chromatogram[[idx_mrm]] <- list()}
if(!idx_mrm %in% names(master_list$data$peakAreaMetabolite)){master_list$data$peakAreaMetabolite[[idx_mrm]] <- list()}
#get precursor and product info from peakRegion table
precursor_mz = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
.$precursor_mz %>% unique()
product_mz = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
.$product_mz %>%
unique()
#find mrm function in the mzML file
mzml_mrm <- master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
.$ms_header_id
#work around if functions and channels have moved as a result of an RT window update
if(length(mzml_mrm) > 1){
mzml_mrm = tempMzml$mzR_header %>%
as_tibble() %>%
filter(chromatogramIndex %in% mzml_mrm) %>%
filter(floor(precursorIsolationWindowTargetMZ) == floor(precursor_mz)) %>%
filter(floor(productIsolationWindowTargetMZ) == floor(product_mz)) %>%
.$chromatogramIndex
}
#peakStart in check
peakStartRT = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
filter(ms_header_id == mzml_mrm) %>%
.$peakStartRT %>% as.numeric() %>% round(digits = 3) %>% min(na.rm = TRUE)
#peakEnd in check
peakEndRT = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
filter(ms_header_id == mzml_mrm) %>%
.$peakEndRT %>% as.numeric() %>% round(digits = 3) %>% max(na.rm = TRUE)
#peakApex in check
peakApexRT = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
filter(ms_header_id == mzml_mrm) %>%
.$peakApexRT %>% as.numeric() %>% round(digits = 3) %>% base::mean(na.rm = TRUE)
#set empty object on first iteration
if(!idx_plate %in% names(master_list$data$chromatogram[[idx_mrm]])){
master_list$data$chromatogram[[idx_mrm]][[idx_plate]] <- list()
master_list$data$chromatogram[[idx_mrm]][[idx_plate]][["all"]] <- list()
master_list$data$chromatogram[[idx_mrm]][[idx_plate]][["peak"]] <- list()
}
#depending on mzR version header could be "rtime" or "time"
if(length(tempMzml$mzR_chromatogram[[mzml_mrm]][["rtime"]]) > 0){mzHeader = "rtime"}
if(length(tempMzml$mzR_chromatogram[[mzml_mrm]][["time"]]) > 0){mzHeader = "time"}
#finalise chromatogram data
tempMzml$smooth <-  #smooth chromatogram
tibble(
time = tempMzml$mzR_chromatogram[[mzml_mrm]][[mzHeader]],
intensity = tempMzml$mzR_chromatogram[[mzml_mrm]][,2] %>%
pracma::savgol(fl = 7, forder = 0, dorder = 0) %>%
pracma::savgol(fl = 5, forder = 0, dorder = 0) %>%
pracma::savgol(fl = 3, forder = 0, dorder = 0)
) %>%
setNames(c("time", "intensity")) %>%
add_column(.before=1,
sampleName = idx_mzML,
samplePlate = idx_plate,
sampleMetabolite = idx_mrm,
precursor_mz = precursor_mz,
product_mz = product_mz) %>%
add_column(.after = "sampleName",
sampleFacet = sub("(?i)_fepp_", ".", paste0(gsub("_.*", "", .$sampleName), "_", gsub(".*@", "", .$sampleName)))
)
#bind chromatogram data for all window
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$all <- bind_rows(
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$all,
tempMzml$smooth
)#bind rows
#get peak Index
peakStartIndex <- which.min(abs(tempMzml$smooth$time - peakStartRT))
#set new end
peakEndIndex <- which.min(abs(tempMzml$smooth$time - peakEndRT))
#crop plot
tempMzml$smoothCrop <- tempMzml$smooth[c(peakStartIndex:peakEndIndex),]
# bind peak region
master_list$data$chromatogram[[idx_mrm]][[idx_plate]][["peak"]] <- bind_rows(
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak,
tempMzml$smoothCrop
)
#plot(master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$intensity)
#get peak intensity using Trapz
peakIntegral <- tempMzml$smoothCrop$intensity %>%
pracma::trapz(.)
#find peak apex
peakApexIdx = which.min(abs(tempMzml$smooth$intensity - max(tempMzml$smoothCrop$intensity)))
# find peak RT
peakRT = tempMzml$smooth$time[peakApexIdx] %>% round(2)
#combine into a master tibble
master_list$data$peakAreaMetabolite[[idx_mrm]] <- bind_rows(
master_list$data$peakAreaMetabolite[[idx_mrm]],
tibble(
samplePlate = idx_plate,
sampleName = idx_mzML,
sampleMetabolite = idx_mrm,
precursor_mz = precursor_mz,
product_mz = product_mz,
peakAreaMetabolite = peakIntegral,
peakRT = peakRT
)
)#bind_rows
} #idx_mrm
}#idx_mzml
}#idx_plate
#rm(tempMzml)
#object for data for chromatogram
master_list$data$chromatogram <- list()
master_list$data$peakAreaMetabolite <- list()
master_list$data$timestamp <- list()
#idx_plate = master_list$project_details$plateList[1] #for testing
#for(idx_plate in master_list$project_details$plateList[1]){ #for testing
for(idx_plate in master_list$project_details$plateList){
print(idx_plate)
master_list$data$timestamp[[idx_plate]] <- list()
idx_mzML = master_list$data$mzR[[idx_plate]][8] #for testing loop
#for(idx_mzML in master_list$data$mzR[[idx_plate]][c(1:6, length(master_list$data$mzR[[idx_plate]]))]){ # for testing loop
for(idx_mzML in master_list$data$mzR[[idx_plate]]){
#create temp mzML object
tempMzml <- list()
#load mzml
tempMzml$mzR_object <- mzR::openMSfile(
filename = paste0(master_list$project_details$plateDirList[grepl(idx_plate, master_list$project_details$plateDirList)], "/", idx_mzML)
)
#create mzR header
tempMzml$mzR_header <- mzR::chromatogramHeader(tempMzml$mzR_object)
#create mzR chromatogram
tempMzml$mzR_chromatogram <- mzR::chromatograms(tempMzml$mzR_object)
#store sample timestamp
master_list$data$timestamp[[idx_plate]] <- bind_rows(
master_list$data$timestamp[[idx_plate]],
tibble(
samplePlate = idx_plate,
sampleName = idx_mzML,
sampleTimestamp = tempMzml$mzR_object@backend$getRunStartTimeStamp()
) %>%
add_column(.before = 1,
sampleID = paste0(.$samplePlate, "_", .$sampleName)
)
)
# extract peak region
#idx_mrm = "GCA-SIL_d4" # for testing loop
#idx_mrm ="TCA-SIL_d4"
for(idx_mrm in names(master_list$data$peakRegionFinal)){
#for(idx_mrm in c("GCA", "GCA-SIL_d4")){
#create list on first iteration of mrm
if(!idx_mrm %in% names(master_list$data$chromatogram)){master_list$data$chromatogram[[idx_mrm]] <- list()}
if(!idx_mrm %in% names(master_list$data$peakAreaMetabolite)){master_list$data$peakAreaMetabolite[[idx_mrm]] <- list()}
#get precursor and product info from peakRegion table
precursor_mz = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
.$precursor_mz %>% unique()
product_mz = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
.$product_mz %>%
unique()
#find mrm function in the mzML file
mzml_mrm <- master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
.$ms_header_id
#work around if functions and channels have moved as a result of an RT window update
if(length(mzml_mrm) > 1){
mzml_mrm = tempMzml$mzR_header %>%
as_tibble() %>%
filter(chromatogramIndex %in% mzml_mrm) %>%
filter(floor(precursorIsolationWindowTargetMZ) == floor(precursor_mz)) %>%
filter(floor(productIsolationWindowTargetMZ) == floor(product_mz)) %>%
.$chromatogramIndex
}
#peakStart in check
peakStartRT = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
filter(ms_header_id == mzml_mrm) %>%
.$peakStartRT %>% as.numeric() %>% round(digits = 3) %>% min(na.rm = TRUE)
#peakEnd in check
peakEndRT = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
filter(ms_header_id == mzml_mrm) %>%
.$peakEndRT %>% as.numeric() %>% round(digits = 3) %>% max(na.rm = TRUE)
#peakApex in check
peakApexRT = master_list$data$peakRegionFinal[[idx_mrm]] %>%
filter(sample_plate == idx_plate) %>%
filter(ms_header_id == mzml_mrm) %>%
.$peakApexRT %>% as.numeric() %>% round(digits = 3) %>% base::mean(na.rm = TRUE)
#set empty object on first iteration
if(!idx_plate %in% names(master_list$data$chromatogram[[idx_mrm]])){
master_list$data$chromatogram[[idx_mrm]][[idx_plate]] <- list()
master_list$data$chromatogram[[idx_mrm]][[idx_plate]][["all"]] <- list()
master_list$data$chromatogram[[idx_mrm]][[idx_plate]][["peak"]] <- list()
}
#depending on mzR version header could be "rtime" or "time"
if(length(tempMzml$mzR_chromatogram[[mzml_mrm]][["rtime"]]) > 0){mzHeader = "rtime"}
if(length(tempMzml$mzR_chromatogram[[mzml_mrm]][["time"]]) > 0){mzHeader = "time"}
#finalise chromatogram data
tempMzml$smooth <-  #smooth chromatogram
tibble(
time = tempMzml$mzR_chromatogram[[mzml_mrm]][[mzHeader]],
intensity = tempMzml$mzR_chromatogram[[mzml_mrm]][,2] %>%
pracma::savgol(fl = 7, forder = 0, dorder = 0) %>%
pracma::savgol(fl = 5, forder = 0, dorder = 0) %>%
pracma::savgol(fl = 3, forder = 0, dorder = 0)
) %>%
setNames(c("time", "intensity")) %>%
add_column(.before=1,
sampleName = idx_mzML,
samplePlate = idx_plate,
sampleMetabolite = idx_mrm,
precursor_mz = precursor_mz,
product_mz = product_mz) %>%
add_column(.after = "sampleName",
sampleFacet = sub("(?i)_fepp_", ".", paste0(gsub("_.*", "", .$sampleName), "_", gsub(".*@", "", .$sampleName)))
)
#bind chromatogram data for all window
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$all <- bind_rows(
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$all,
tempMzml$smooth
)#bind rows
#get peak Index
peakStartIndex <- which.min(abs(tempMzml$smooth$time - peakStartRT))
#set new end
peakEndIndex <- which.min(abs(tempMzml$smooth$time - peakEndRT))
#crop plot
tempMzml$smoothCrop <- tempMzml$smooth[c(peakStartIndex:peakEndIndex),]
# bind peak region
master_list$data$chromatogram[[idx_mrm]][[idx_plate]][["peak"]] <- bind_rows(
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak,
tempMzml$smoothCrop
)
#plot(master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$intensity)
#get peak intensity using Trapz
peakIntegral <- tempMzml$smoothCrop$intensity %>%
pracma::trapz(.)
#find peak apex
peakApexIdx = which.min(abs(tempMzml$smooth$intensity - max(tempMzml$smoothCrop$intensity)))
# find peak RT
peakRT = tempMzml$smooth$time[peakApexIdx] %>% round(2)
#combine into a master tibble
master_list$data$peakAreaMetabolite[[idx_mrm]] <- bind_rows(
master_list$data$peakAreaMetabolite[[idx_mrm]],
tibble(
samplePlate = idx_plate,
sampleName = idx_mzML,
sampleMetabolite = idx_mrm,
precursor_mz = precursor_mz,
product_mz = product_mz,
peakAreaMetabolite = peakIntegral,
peakRT = peakRT
)
)#bind_rows
} #idx_mrm
}#idx_mzml
}#idx_plate
#create dir.
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/peakIntegrals"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/peakIntegrals"))
}
#object for data for chromatogram
#master_list$plots$chromatogram <- list()
#RColorBrewer::brewer.pal(n=7, name = "Set1")
#prepare colours
plotColors = c(
check = "#E41A1C" ,
ltr = "#4DAF4A",
vltr = "#984EA3",
sltr = "gold",
pqc = "#FF7F00",
sample = "#377EB8",
blank = "darkgrey"
)
#idx_mrm = "TRYP" # for testing loop
i = 1
totalMRM = length(names(master_list$data$peakRegionFinal))
for(idx_mrm in names(master_list$data$peakRegionFinal)){
#master_list$plots$chromatogram[[idx_mrm]] <- list()
message(paste0("printing plot ", i, " of ", totalMRM, "; ", idx_mrm, ".  "))
i=i+1
#open png device
pdf(onefile = TRUE, width = 16, height = 7.5,
file =
paste0(
master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/peakIntegrals/",
Sys.Date(), "_", master_list$project_details$project_name, "_AB_peakIntegrals_",  gsub(" ", "_", fedmatch::clean_strings(idx_mrm)), ".pdf"
)
)
#idx_plate="RARp003a"
#for(idx_plate in master_list$project_details$plateList[1]){ #for testing
for(idx_plate in master_list$project_details$plateList){
#prepare data
#add sampleType
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleType <- "sample"
#check sample
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleType[grep(
"check", master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleName, ignore.case = TRUE)] <- "check"
#ltr sample
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleType[grep(
"ltr", master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleName, ignore.case = TRUE)] <- "ltr"
#vltr sample
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleType[grep(
"vltr", master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleName, ignore.case = TRUE)] <- "vltr"
#sltr sample
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleType[grep(
"sltr", master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleName, ignore.case = TRUE)] <- "sltr"
#pqc sample
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleType[grep(
"pqc", master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleName, ignore.case = TRUE)] <- "pqc"
#blank sample
master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleType[grep(
"blank", master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak$sampleName, ignore.case = TRUE)] <- "blank"
#get peak start RT for vlines
peakStart <- master_list$data$peakRegionFinal[[idx_mrm]] %>% filter(sample_plate == idx_plate) %>% .$peakStartRT %>% as.numeric() %>% min(na.rm = TRUE) %>% round(2)
peakEnd <- master_list$data$peakRegionFinal[[idx_mrm]] %>% filter(sample_plate == idx_plate) %>% .$peakEndRT %>% as.numeric() %>%  max(na.rm = TRUE) %>% round(2)
mrmTitle <- master_list$data$peakRegionFinal[[idx_mrm]] %>% .$mrm %>% unique()
#create plot
loopPlot <- ggplot(
data = master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$all,
aes(x = time, y = intensity)) +
geom_vline(xintercept = peakStart, linetype = "dashed") +
geom_vline(xintercept = peakEnd, linetype = "dashed") +
#geom_point(shape = 4, size = 2, color = "lightgrey") +
geom_line(na.rm = TRUE, colour = "grey") +
geom_line(
data = master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$peak,
aes(x = time, y = intensity, color = sampleType), na.rm = TRUE) +
theme_bw() +
ggtitle(paste0(idx_mrm, "; ", mrmTitle, "; ", idx_plate, "; peak start = ", peakStart, "; peak end = ", peakEnd)) +
scale_y_continuous(labels = scales::scientific) +
scale_colour_manual(values = plotColors) +
facet_wrap(scales = "free_y", facets = "sampleFacet") +
theme(
axis.text = element_text(size = 6),
strip.text = element_text(size = 5)
) +
scale_x_continuous(breaks = round(seq(min(master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$all$time), max(master_list$data$chromatogram[[idx_mrm]][[idx_plate]]$all$time), by = 0.1), 1))
print(loopPlot)
}#idx_plate
dev.off()
}#idx_mrm
#print(Sys.time() - a)
if(functionListMethod == "CCC"){
#create dir.
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
#open PDF
pageWidth <- length(master_list$project_details$plateList)
#open pdf device
pdf(
onefile = TRUE, width = (15 + pageWidth), height = 10,
file = paste0(
master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC/", Sys.Date(), "_", master_list$project_details$project_name, "_SPE_", master_list$project_details$wash, "_CCC.pdf"
)
)
#make plot list
CCCplotList <- names(master_list$data$peakAreaMetabolite)
CCCplotList <- CCCplotList[!grepl("-SIL", CCCplotList)]
CCCplotList <- sort(CCCplotList)
idxPlot = CCCplotList[4]
for(idxPlot in CCCplotList){
message(paste0("printing CCC for ", idxPlot))
subPlotList <- names(master_list$data$peakAreaMetabolite)[grepl(idxPlot, names(master_list$data$peakAreaMetabolite), fixed = TRUE)]
plotData <- left_join(by = "sampleName",
master_list$data$peakAreaMetabolite[subPlotList[!grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)),
master_list$data$peakAreaMetabolite[subPlotList[grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)) %>%
select(sampleName, peakAreaMetabolite) %>%
rename(peakAreaSil = peakAreaMetabolite)
) %>%
arrange(samplePlate, sampleName) %>%
add_column(
peakResponse = .$peakAreaMetabolite/.$peakAreaSil,
index = c(1:nrow(.))
) %>%
select(index, samplePlate, sampleName, peakAreaMetabolite, peakAreaMetabolite, peakAreaSil, peakResponse) %>%
pivot_longer(data = .,
c("peakAreaMetabolite", "peakAreaSil", "peakResponse"),
names_to = "dataType",
values_to = "value"
) %>%
mutate(
samplePlate = gsub("a", "", samplePlate),
samplePlate = gsub("b", "", samplePlate),
sampleType = sampleName %>% gsub(".*p0", "", .) %>% sub("_", "-", .)%>% gsub(".*-", "", .) %>% gsub("_.*", "", .)
)
#set plate boundaries
plateBoundaryIdx = NULL
for(idxPlate in unique(plotData$samplePlate)){
plateBoundaryIdx <- c(
plateBoundaryIdx,
plotData %>%
filter(samplePlate == idxPlate) %>%
.$index %>%
max()
)
}
plateBoundaryIdx <- plateBoundaryIdx[-length(plateBoundaryIdx)]
#make plot
plotList = list(
title = data.frame(x = 0.5, y = 0.5, label = idxPlot) %>%
ggplot(., aes(x = x, y = y, label = label)) +
geom_text(size = 6) +
theme_void() +  # removes axes and background
xlim(0, 1) + ylim(0, 1)  # optional: set limits to centre the text
)
idxData = unique(plotData$dataType)[3]
for(idxData in unique(plotData$dataType)){
loopPlotData = plotData %>%
filter(dataType == idxData)
#set custom y limits
ylimits = c(median(loopPlotData$value, na.rm = TRUE)- (IQR(loopPlotData$value, na.rm = TRUE)*4),
median(loopPlotData$value, na.rm = TRUE) + (IQR(loopPlotData$value, na.rm = TRUE)*4)
)
#make plot
plotList[[idxData]] <- loopPlotData %>%
filter(sampleType != "SLTR") %>%
ggplot(
aes(
x=index,
y=value,
fill = sampleType,
shape = sampleType,
size=sampleType,
colour = sampleType
)
) +
geom_point() +
scale_fill_manual(values = c("LTR" = "#F8766D", "PQC" = "#7CAE00", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_colour_manual(values = c("LTR" = "black", "PQC" = "black", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_shape_manual(values = c("LTR" = 21, "PQC" = 21, "SLTR" = 4, "vLTR" = 4))+
scale_size_manual(values = c("LTR" = 4, "PQC" = 4, "SLTR" = 1.5, "vLTR" = 2)) +
ggtitle(idxData)+
theme_bw() +
geom_vline(xintercept = plateBoundaryIdx) +
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "PQC") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#7CAE00", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "LTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#F8766D", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "vLTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "black", linewidth = 0.5)+
ylim(ylimits)
}#idxData
print(
cowplot::plot_grid(
plotlist = plotList,
ncol = 1 ,
rel_heights = c(0.1,1,1,1)
)
)
} #idxPlot
dev.off() #turn off pdf
} #if
