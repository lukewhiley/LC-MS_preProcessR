abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR\\(2:0\\)", "CAR\\(2:0\\)-SIL_d3", "CAR\\(4\\:0\\)", "CAR\\(4\\:0\\)-SIL_d3", "CAR\\(i5\\:0\\)", "CAR\\(i5\\:0\\)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
paste0("^(", paste(abList, collapse = "|"), ")$")
nList <- c(
"5-HIAA", "5-HIAA-SIL_d5", "CDCA", "CDCA-SIL_d4", "GCDCA", "GCDCA-SIL_d4", "GUDCA", "GUDCA-SIL_d4",
"XA", "XA-SIL_d4", "12\\(R\\)-HETE", "12\\(R\\)-HETE-SIL_d8",  "15\\(S\\)-HETE","15\\(S\\)-HETE-SIL_d8", "8i-PGF2a", "8i-PGF2a-SIL_d4"
)
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR\\(2:0\\)", "CAR\\(2:0\\)-SIL_d3", "CAR\\(4\\:0\\)", "CAR\\(4\\:0\\)-SIL_d3", "CAR\\(i5\\:0\\)", "CAR\\(i5\\:0\\)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
names(master_list$data$peakAreaMetabolite)
master_list$project_details$wash
master_list$project_details$wash == "AB"
nList <- c(
"5-HIAA", "5-HIAA-SIL_d5", "CDCA", "CDCA-SIL_d4", "GCDCA", "GCDCA-SIL_d4", "GUDCA", "GUDCA-SIL_d4",
"XA", "XA-SIL_d4", "12\\(R\\)-HETE", "12\\(R\\)-HETE-SIL_d8",  "15\\(S\\)-HETE","15\\(S\\)-HETE-SIL_d8", "8i-PGF2a", "8i-PGF2a-SIL_d4"
)
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR\\(2:0\\)", "CAR\\(2:0\\)-SIL_d3", "CAR\\(4\\:0\\)", "CAR\\(4\\:0\\)-SIL_d3", "CAR\\(i5\\:0\\)", "CAR\\(i5\\:0\\)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- ablist)}; if(master_list$project_details$wash == "N"){CCCplotList <- nList)}
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- ablist)}; if(master_list$project_details$wash == "N"){CCCplotList <- nList}
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- ablist}; if(master_list$project_details$wash == "N"){CCCplotList <- nList}
nList <- c(
"5-HIAA", "5-HIAA-SIL_d5", "CDCA", "CDCA-SIL_d4", "GCDCA", "GCDCA-SIL_d4", "GUDCA", "GUDCA-SIL_d4",
"XA", "XA-SIL_d4", "12\\(R\\)-HETE", "12\\(R\\)-HETE-SIL_d8",  "15\\(S\\)-HETE","15\\(S\\)-HETE-SIL_d8", "8i-PGF2a", "8i-PGF2a-SIL_d4"
)
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR\\(2:0\\)", "CAR\\(2:0\\)-SIL_d3", "CAR\\(4\\:0\\)", "CAR\\(4\\:0\\)-SIL_d3", "CAR\\(i5\\:0\\)", "CAR\\(i5\\:0\\)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
nList <- c(
"5-HIAA", "5-HIAA-SIL_d5", "CDCA", "CDCA-SIL_d4", "GCDCA", "GCDCA-SIL_d4", "GUDCA", "GUDCA-SIL_d4",
"XA", "XA-SIL_d4", "12\\(R\\)-HETE", "12\\(R\\)-HETE-SIL_d8",  "15\\(S\\)-HETE","15\\(S\\)-HETE-SIL_d8", "8i-PGF2a", "8i-PGF2a-SIL_d4"
)
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR\\(2:0\\)", "CAR\\(2:0\\)-SIL_d3", "CAR\\(4\\:0\\)", "CAR\\(4\\:0\\)-SIL_d3", "CAR\\(i5\\:0\\)", "CAR\\(i5\\:0\\)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- ablist}; if(master_list$project_details$wash == "N"){CCCplotList <- nList}
nList <- c(
"5-HIAA", "5-HIAA-SIL_d5", "CDCA", "CDCA-SIL_d4", "GCDCA", "GCDCA-SIL_d4", "GUDCA", "GUDCA-SIL_d4",
"XA", "XA-SIL_d4", "12\\(R\\)-HETE", "12\\(R\\)-HETE-SIL_d8",  "15\\(S\\)-HETE","15\\(S\\)-HETE-SIL_d8", "8i-PGF2a", "8i-PGF2a-SIL_d4"
)
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR\\(2:0\\)", "CAR\\(2:0\\)-SIL_d3", "CAR\\(4\\:0\\)", "CAR\\(4\\:0\\)-SIL_d3", "CAR\\(i5\\:0\\)", "CAR\\(i5\\:0\\)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- abList}; if(master_list$project_details$wash == "N"){CCCplotList <- nList}
CCCplotList <- CCCplotList[!grepl("-SIL", CCCplotList)]
CCCplotList <- sort(CCCplotList)
CCCplotList
#if(functionListMethod == "CCC"){
nList <- c(
"5-HIAA", "5-HIAA-SIL_d5", "CDCA", "CDCA-SIL_d4", "GCDCA", "GCDCA-SIL_d4", "GUDCA", "GUDCA-SIL_d4",
"XA", "XA-SIL_d4", "12\\(R\\)-HETE", "12\\(R\\)-HETE-SIL_d8",  "15\\(S\\)-HETE","15\\(S\\)-HETE-SIL_d8", "8i-PGF2a", "8i-PGF2a-SIL_d4"
)
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR\\(2:0\\)", "CAR\\(2:0\\)-SIL_d3", "CAR\\(4\\:0\\)", "CAR\\(4\\:0\\)-SIL_d3", "CAR\\(i5\\:0\\)", "CAR\\(i5\\:0\\)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
#create dir.
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- abList}; if(master_list$project_details$wash == "N"){CCCplotList <- nList}
CCCplotList <- CCCplotList[!grepl("-SIL", CCCplotList)]
CCCplotList <- sort(CCCplotList)
#open PDF
pageWidth <- length(master_list$project_details$plateList)
#open pdf device
pdf(
onefile = TRUE, width = (15 + pageWidth), height = 10,
file = paste0(
master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC/", Sys.Date(), "_", master_list$project_details$project_name, "_SPE_", master_list$project_details$wash, "_CCC.pdf"
)
)
idxPlot = CCCplotList[4]
for(idxPlot in CCCplotList){
message(paste0("printing CCC for ", idxPlot))
subPlotList <- names(master_list$data$peakAreaMetabolite)[grepl(idxPlot, names(master_list$data$peakAreaMetabolite), fixed = TRUE)]
plotData <- left_join(by = "sampleName",
master_list$data$peakAreaMetabolite[subPlotList[!grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)),
master_list$data$peakAreaMetabolite[subPlotList[grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)) %>%
select(sampleName, peakAreaMetabolite) %>%
rename(peakAreaSil = peakAreaMetabolite)
) %>%
arrange(samplePlate, sampleName) %>%
add_column(
peakResponse = .$peakAreaMetabolite/.$peakAreaSil,
index = c(1:nrow(.))
) %>%
select(index, samplePlate, sampleName, peakAreaMetabolite, peakAreaMetabolite, peakAreaSil, peakResponse) %>%
pivot_longer(data = .,
c("peakAreaMetabolite", "peakAreaSil", "peakResponse"),
names_to = "dataType",
values_to = "value"
) %>%
mutate(
samplePlate = gsub("a", "", samplePlate),
samplePlate = gsub("b", "", samplePlate),
sampleType = sampleName %>% gsub(".*p0", "", .) %>% sub("_", "-", .)%>% gsub(".*-", "", .) %>% gsub("_.*", "", .)
)
#set plate boundaries
plateBoundaryIdx = NULL
for(idxPlate in unique(plotData$samplePlate)){
plateBoundaryIdx <- c(
plateBoundaryIdx,
plotData %>%
filter(samplePlate == idxPlate) %>%
.$index %>%
max()
)
}
plateBoundaryIdx <- plateBoundaryIdx[-length(plateBoundaryIdx)]
#make plot
plotList = list(
title = data.frame(x = 0.5, y = 0.5, label = idxPlot) %>%
ggplot(., aes(x = x, y = y, label = label)) +
geom_text(size = 6) +
theme_void() +  # removes axes and background
xlim(0, 1) + ylim(0, 1)  # optional: set limits to centre the text
)
idxData = unique(plotData$dataType)[3]
for(idxData in unique(plotData$dataType)){
loopPlotData = plotData %>%
filter(dataType == idxData)
#set custom y limits
ylimits = c(median(loopPlotData$value, na.rm = TRUE)- (IQR(loopPlotData$value, na.rm = TRUE)*4),
median(loopPlotData$value, na.rm = TRUE) + (IQR(loopPlotData$value, na.rm = TRUE)*4)
)
#make plot
plotList[[idxData]] <- loopPlotData %>%
filter(sampleType != "SLTR") %>%
ggplot(
aes(
x=index,
y=value,
fill = sampleType,
shape = sampleType,
size=sampleType,
colour = sampleType
)
) +
geom_point() +
scale_fill_manual(values = c("LTR" = "#F8766D", "PQC" = "#7CAE00", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_colour_manual(values = c("LTR" = "black", "PQC" = "black", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_shape_manual(values = c("LTR" = 21, "PQC" = 21, "SLTR" = 4, "vLTR" = 4))+
scale_size_manual(values = c("LTR" = 4, "PQC" = 4, "SLTR" = 1.5, "vLTR" = 2)) +
ggtitle(idxData)+
theme_bw() +
geom_vline(xintercept = plateBoundaryIdx) +
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "PQC") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#7CAE00", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "LTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#F8766D", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "vLTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "black", linewidth = 0.5)+
ylim(ylimits)
}#idxData
print(
cowplot::plot_grid(
plotlist = plotList,
ncol = 1 ,
rel_heights = c(0.1,1,1,1)
)
)
} #idxPlot
idxPlot
message(paste0("printing CCC for ", idxPlot))
subPlotList <- names(master_list$data$peakAreaMetabolite)[grepl(idxPlot, names(master_list$data$peakAreaMetabolite), fixed = TRUE)]
plotData <- left_join(by = "sampleName",
master_list$data$peakAreaMetabolite[subPlotList[!grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)),
master_list$data$peakAreaMetabolite[subPlotList[grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)) %>%
select(sampleName, peakAreaMetabolite) %>%
rename(peakAreaSil = peakAreaMetabolite)
) %>%
arrange(samplePlate, sampleName) %>%
add_column(
peakResponse = .$peakAreaMetabolite/.$peakAreaSil,
index = c(1:nrow(.))
) %>%
select(index, samplePlate, sampleName, peakAreaMetabolite, peakAreaMetabolite, peakAreaSil, peakResponse) %>%
pivot_longer(data = .,
c("peakAreaMetabolite", "peakAreaSil", "peakResponse"),
names_to = "dataType",
values_to = "value"
) %>%
mutate(
samplePlate = gsub("a", "", samplePlate),
samplePlate = gsub("b", "", samplePlate),
sampleType = sampleName %>% gsub(".*p0", "", .) %>% sub("_", "-", .)%>% gsub(".*-", "", .) %>% gsub("_.*", "", .)
)
master_list$data$peakAreaMetabolite[subPlotList[!grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE))
master_list$data$peakAreaMetabolite
dev.off()
master_list$data$peakAreaMetabolite$`CAR(2:0)-SIL_d3`
master_list$data$peakAreaMetabolite$`CAR(2:0)`
idxPlot
master_list$data$peakAreaMetabolite[idxPlot]
master_list$data$peakAreaMetabolite[[idxPlot]]
idxPlate = "CAR(2:0)"
master_list$data$peakAreaMetabolite[[idxPlot]]
master_list$data$peakAreaMetabolite["CAR(2:0)"]
master_list$data$peakAreaMetabolite[["CAR(2:0)"]]
"CAR(2:0)"
"CAR(2:0)" ==idxPlot
idxPlot
idxPlot = "CAR(2:0)"
"CAR(2:0)" ==idxPlot
master_list$data$peakAreaMetabolite[[idxPlot]]
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR(2:0)", "CAR(2:0)-SIL_d3", "CAR(4:0)", "CAR(4:0)-SIL_d3", "CAR(i5:0)", "CAR(i5:0)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- abList}; if(master_list$project_details$wash == "N"){CCCplotList <- nList}
CCCplotList <- CCCplotList[!grepl("-SIL", CCCplotList)]
CCCplotList <- sort(CCCplotList)
CCCplotList
idxPlot = CCCplotList[2]
idxPlot
message(paste0("printing CCC for ", idxPlot))
subPlotList <- names(master_list$data$peakAreaMetabolite)[grepl(idxPlot, names(master_list$data$peakAreaMetabolite), fixed = TRUE)]
plotData <- left_join(by = "sampleName",
master_list$data$peakAreaMetabolite[subPlotList[!grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)),
master_list$data$peakAreaMetabolite[subPlotList[grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)) %>%
select(sampleName, peakAreaMetabolite) %>%
rename(peakAreaSil = peakAreaMetabolite)
) %>%
arrange(samplePlate, sampleName) %>%
add_column(
peakResponse = .$peakAreaMetabolite/.$peakAreaSil,
index = c(1:nrow(.))
) %>%
select(index, samplePlate, sampleName, peakAreaMetabolite, peakAreaMetabolite, peakAreaSil, peakResponse) %>%
pivot_longer(data = .,
c("peakAreaMetabolite", "peakAreaSil", "peakResponse"),
names_to = "dataType",
values_to = "value"
) %>%
mutate(
samplePlate = gsub("a", "", samplePlate),
samplePlate = gsub("b", "", samplePlate),
sampleType = sampleName %>% gsub(".*p0", "", .) %>% sub("_", "-", .)%>% gsub(".*-", "", .) %>% gsub("_.*", "", .)
)
idxPlot = CCCplotList[2]
for(idxPlot in CCCplotList){
message(paste0("printing CCC for ", idxPlot))
subPlotList <- names(master_list$data$peakAreaMetabolite)[grepl(idxPlot, names(master_list$data$peakAreaMetabolite), fixed = TRUE)]
plotData <- left_join(by = "sampleName",
master_list$data$peakAreaMetabolite[subPlotList[!grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)),
master_list$data$peakAreaMetabolite[subPlotList[grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)) %>%
select(sampleName, peakAreaMetabolite) %>%
rename(peakAreaSil = peakAreaMetabolite)
) %>%
arrange(samplePlate, sampleName) %>%
add_column(
peakResponse = .$peakAreaMetabolite/.$peakAreaSil,
index = c(1:nrow(.))
) %>%
select(index, samplePlate, sampleName, peakAreaMetabolite, peakAreaMetabolite, peakAreaSil, peakResponse) %>%
pivot_longer(data = .,
c("peakAreaMetabolite", "peakAreaSil", "peakResponse"),
names_to = "dataType",
values_to = "value"
) %>%
mutate(
samplePlate = gsub("a", "", samplePlate),
samplePlate = gsub("b", "", samplePlate),
sampleType = sampleName %>% gsub(".*p0", "", .) %>% sub("_", "-", .)%>% gsub(".*-", "", .) %>% gsub("_.*", "", .)
)
#set plate boundaries
plateBoundaryIdx = NULL
for(idxPlate in unique(plotData$samplePlate)){
plateBoundaryIdx <- c(
plateBoundaryIdx,
plotData %>%
filter(samplePlate == idxPlate) %>%
.$index %>%
max()
)
}
plateBoundaryIdx <- plateBoundaryIdx[-length(plateBoundaryIdx)]
#make plot
plotList = list(
title = data.frame(x = 0.5, y = 0.5, label = idxPlot) %>%
ggplot(., aes(x = x, y = y, label = label)) +
geom_text(size = 6) +
theme_void() +  # removes axes and background
xlim(0, 1) + ylim(0, 1)  # optional: set limits to centre the text
)
idxData = unique(plotData$dataType)[3]
for(idxData in unique(plotData$dataType)){
loopPlotData = plotData %>%
filter(dataType == idxData)
#set custom y limits
ylimits = c(median(loopPlotData$value, na.rm = TRUE)- (IQR(loopPlotData$value, na.rm = TRUE)*4),
median(loopPlotData$value, na.rm = TRUE) + (IQR(loopPlotData$value, na.rm = TRUE)*4)
)
#make plot
plotList[[idxData]] <- loopPlotData %>%
filter(sampleType != "SLTR") %>%
ggplot(
aes(
x=index,
y=value,
fill = sampleType,
shape = sampleType,
size=sampleType,
colour = sampleType
)
) +
geom_point() +
scale_fill_manual(values = c("LTR" = "#F8766D", "PQC" = "#7CAE00", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_colour_manual(values = c("LTR" = "black", "PQC" = "black", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_shape_manual(values = c("LTR" = 21, "PQC" = 21, "SLTR" = 4, "vLTR" = 4))+
scale_size_manual(values = c("LTR" = 4, "PQC" = 4, "SLTR" = 1.5, "vLTR" = 2)) +
ggtitle(idxData)+
theme_bw() +
geom_vline(xintercept = plateBoundaryIdx) +
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "PQC") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#7CAE00", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "LTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#F8766D", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "vLTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "black", linewidth = 0.5)+
ylim(ylimits)
}#idxData
print(
cowplot::plot_grid(
plotlist = plotList,
ncol = 1 ,
rel_heights = c(0.1,1,1,1)
)
)
} #idxPlot
#if(functionListMethod == "CCC"){
nList <- c(
"5-HIAA", "5-HIAA-SIL_d5", "CDCA", "CDCA-SIL_d4", "GCDCA", "GCDCA-SIL_d4", "GUDCA", "GUDCA-SIL_d4",
"XA", "XA-SIL_d4", "12\\(R\\)-HETE", "12\\(R\\)-HETE-SIL_d8",  "15\\(S\\)-HETE","15\\(S\\)-HETE-SIL_d8", "8i-PGF2a", "8i-PGF2a-SIL_d4"
)
abList <- c(
"3-HAA", "3-HAA-SIL_D3", "CAR(2:0)", "CAR(2:0)-SIL_d3", "CAR(4:0)", "CAR(4:0)-SIL_d3", "CAR(i5:0)", "CAR(i5:0)-SIL_d9", "KYN", "KYN-SIL_D4", "NEO", "NEO-SIL_13C5", "TRYP", "TRYP-SIL_d5", "SER", "SER-SIL_d4"
)
#create dir.
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots"))
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC"))
}
#make plot list
if(master_list$project_details$wash == "AB"){CCCplotList <- abList}; if(master_list$project_details$wash == "N"){CCCplotList <- nList}
CCCplotList <- CCCplotList[!grepl("-SIL", CCCplotList)]
CCCplotList <- sort(CCCplotList)
#open PDF
pageWidth <- length(master_list$project_details$plateList)
#open pdf device
pdf(
onefile = TRUE, width = (15 + pageWidth), height = 10,
file = paste0(
master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/CCC/", Sys.Date(), "_", master_list$project_details$project_name, "_SPE_", master_list$project_details$wash, "_CCC.pdf"
)
)
idxPlot = CCCplotList[2]
for(idxPlot in CCCplotList){
message(paste0("printing CCC for ", idxPlot))
subPlotList <- names(master_list$data$peakAreaMetabolite)[grepl(idxPlot, names(master_list$data$peakAreaMetabolite), fixed = TRUE)]
plotData <- left_join(by = "sampleName",
master_list$data$peakAreaMetabolite[subPlotList[!grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)),
master_list$data$peakAreaMetabolite[subPlotList[grepl("SIL", subPlotList)]][[1]] %>%
filter(!grepl("check", sampleName, ignore.case = TRUE)) %>%
select(sampleName, peakAreaMetabolite) %>%
rename(peakAreaSil = peakAreaMetabolite)
) %>%
arrange(samplePlate, sampleName) %>%
add_column(
peakResponse = .$peakAreaMetabolite/.$peakAreaSil,
index = c(1:nrow(.))
) %>%
select(index, samplePlate, sampleName, peakAreaMetabolite, peakAreaMetabolite, peakAreaSil, peakResponse) %>%
pivot_longer(data = .,
c("peakAreaMetabolite", "peakAreaSil", "peakResponse"),
names_to = "dataType",
values_to = "value"
) %>%
mutate(
samplePlate = gsub("a", "", samplePlate),
samplePlate = gsub("b", "", samplePlate),
sampleType = sampleName %>% gsub(".*p0", "", .) %>% sub("_", "-", .)%>% gsub(".*-", "", .) %>% gsub("_.*", "", .)
)
#set plate boundaries
plateBoundaryIdx = NULL
for(idxPlate in unique(plotData$samplePlate)){
plateBoundaryIdx <- c(
plateBoundaryIdx,
plotData %>%
filter(samplePlate == idxPlate) %>%
.$index %>%
max()
)
}
plateBoundaryIdx <- plateBoundaryIdx[-length(plateBoundaryIdx)]
#make plot
plotList = list(
title = data.frame(x = 0.5, y = 0.5, label = idxPlot) %>%
ggplot(., aes(x = x, y = y, label = label)) +
geom_text(size = 6) +
theme_void() +  # removes axes and background
xlim(0, 1) + ylim(0, 1)  # optional: set limits to centre the text
)
idxData = unique(plotData$dataType)[3]
for(idxData in unique(plotData$dataType)){
loopPlotData = plotData %>%
filter(dataType == idxData)
#set custom y limits
ylimits = c(median(loopPlotData$value, na.rm = TRUE)- (IQR(loopPlotData$value, na.rm = TRUE)*4),
median(loopPlotData$value, na.rm = TRUE) + (IQR(loopPlotData$value, na.rm = TRUE)*4)
)
#make plot
plotList[[idxData]] <- loopPlotData %>%
filter(sampleType != "SLTR") %>%
ggplot(
aes(
x=index,
y=value,
fill = sampleType,
shape = sampleType,
size=sampleType,
colour = sampleType
)
) +
geom_point() +
scale_fill_manual(values = c("LTR" = "#F8766D", "PQC" = "#7CAE00", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_colour_manual(values = c("LTR" = "black", "PQC" = "black", "SLTR" = "#00BFC4", "vLTR" = "black")) +
scale_shape_manual(values = c("LTR" = 21, "PQC" = 21, "SLTR" = 4, "vLTR" = 4))+
scale_size_manual(values = c("LTR" = 4, "PQC" = 4, "SLTR" = 1.5, "vLTR" = 2)) +
ggtitle(idxData)+
theme_bw() +
geom_vline(xintercept = plateBoundaryIdx) +
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "PQC") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#7CAE00", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "LTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "#F8766D", linewidth = 1)+
geom_hline(yintercept = loopPlotData %>% filter(sampleType == "vLTR") %>% .$value %>% median(na.rm = TRUE), linetype = "dashed", colour = "black", linewidth = 0.5)+
ylim(ylimits)
}#idxData
print(
cowplot::plot_grid(
plotlist = plotList,
ncol = 1 ,
rel_heights = c(0.1,1,1,1)
)
)
} #idxPlot
dev.off() #turn off pdf
#} #if
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/data/rda/"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/data/rda/"))
}
save(
master_list,
file = paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/data/rda/",
Sys.Date(), "_",
master_list$project_details$project_name,
"_SPE_AB_checkpoint_1.rda"
)
)
# load(file =  "C:\\Users\\300828F\\Murdoch University\\Australian National Phenome Centre - Technical & Operational\\Laboratory QA QC\\Control Chart Reviews\\SPE-MCX\\20250506_PLA_V2_LIFT\\N\\data\\rda\\2025-06-25_LIFT_SPE_AB_checkpoint_1.rda")
#
# master_list$project_details$project_dir <- "C:\\Users\\300828F\\Murdoch University\\Australian National Phenome Centre - Technical & Operational\\Laboratory QA QC\\Control Chart Reviews\\SPE-MCX\\20250506_PLA_V2_LIFT"
#
# master_list$project_details$wash <- "N"
master_list$project_details$wash
