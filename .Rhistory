scale_fill_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = NA, "pqcCor" = "orchid", "ltr" = NA, "ltrCor" = "seagreen3")) +
geom_hline(data= loopMedian, aes(yintercept=median_val), colour = "orchid4", linetype ="dotted", linewidth = 1) +
geom_hline(data= loopMedianCor, aes(yintercept=median_val), colour = "orchid4", linetype ="solid", linewidth = .8) +
facet_wrap(facets = "facet", ncol = 1, scales = "free_y") +
scale_y_continuous(labels = scales::label_scientific()) +
ggtitle(plotTitle) +
theme(legend.position = "none")
####------------------------
## VIolin plots
####------------------------
violinData = plotDataALL %>%
#filter(dataType == "responseBatchCorrected" | dataType == "response") %>%
mutate(sample_plate = sub("a", "", sample_plate)) %>%
mutate(sample_plate = sub("b", "", sample_plate)) %>%
#add columns tio violinData
add_column(
side = ifelse(grepl("Cor", .$sample_type), "r", "l"),
sample_type_x = gsub("Cor", "", .$sample_type)
)
#add max/min dummy data to normalise axis on facet_wrap
for(idx_dataType in unique(violinData$dataType)){
#work around to normalise axis on per plate plot
maxValue <- violinData %>%
filter(dataType == idx_dataType) %>%
.$value %>%
max()
minValue <- violinData %>%
filter(dataType == idx_dataType) %>%
.$value %>%
min()
#make dummy data per plate for plot control
dummyData = list()
for(idx_plate in unique(violinData$sample_plate)){
dummyData <- dummyData %>%
bind_rows(.,
bind_rows(
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == maxValue))[1,],
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == minValue))[1,]
) %>% mutate(
sample_plate = idx_plate,
sample_run_index = NA)
)
} # idx plate\
for(idx_sampleType in unique(violinData$sample_type_x)){
dummyData <- dummyData %>%
bind_rows(.,
bind_rows(
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == maxValue))[1,],
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == minValue))[1,]
) %>% mutate(
sample_type_x = idx_sampleType,
sample_run_index = NA)
)
} # idx sampleType
#add dummy data to violinData
violinData <- violinData %>%
bind_rows(.,
dummyData)
}
#change sample type for colour control
violinData$sample_type[is.na(violinData$sample_run_index)] <- "NA"
#mutate to factor
violinData <- violinData %>%
mutate(
sample_type_x = factor(sample_type_x, levels = c("pqc", "ltr", "sample", "NA"), ordered = TRUE),
sample_plate_idx = factor(sample_plate)
) %>%
mutate(
sample_plate_idx = as.integer(sample_plate_idx)
) %>%
mutate(
sample_plate_idx = as.factor(sample_plate_idx)
)
#make plot
violinPlot <- ggplot(data = violinData, aes(x = sample_type_x, y = value, fill = sample_type, color = sample_type)) +
theme_bw() +
# Split violin using gghalves
geom_half_violin(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0),
trim = TRUE, alpha = 1, scale = "width"
) +
geom_half_violin(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = 0),
trim = TRUE, alpha = 0.25, scale = "width"
) +
geom_hline(data= loopMedian, aes(yintercept=median_val), colour = "orchid1", linetype ="dotted", linewidth = 1) +
geom_hline(data= loopMedianCor, aes(yintercept=median_val), colour = "orchid4", linetype ="solid", linewidth = .8) +
geom_half_boxplot(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
geom_half_boxplot(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = -0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
facet_wrap(facets = c("facet"), ncol=1, scales="free_y") +
scale_fill_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"= NA)) +
scale_color_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"= NA)) +
scale_y_continuous(labels = scales::label_scientific()) +
#scale_shape_manual(values = c("sample" = 0, "sampleCor" = 23, "pqc" = 22, "pqcCor" = 23, "ltr" = 22, "ltrCor" = 23)) +
ggtitle("all plates") +
theme(legend.position = "none")
#make a plot per plate
violinPlotplate <- ggplot(data = violinData, aes(x = sample_plate_idx, y = value, fill = sample_type, color = sample_type)) +
theme_bw() +
# Split violin using gghalves
geom_half_violin(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0),
trim = TRUE, alpha = 1, scale = "width"
) +
geom_half_violin(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = 0),
trim = TRUE, alpha = 0.25, scale = "width"
) +
geom_hline(data= loopMedian, aes(yintercept=median_val), colour = "orchid1", linetype ="dotted", linewidth = 1, alpha = 1) +
geom_hline(data= loopMedianCor, aes(yintercept=median_val), colour = "orchid4", linetype ="solid", linewidth = .8, alpha = 1) +
geom_half_boxplot(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
geom_half_boxplot(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = -0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
facet_wrap(facets = c("facet", "sample_type_x"), ncol = length(unique(violinData$sample_type_x)), scales = "free_y") +
scale_fill_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"=NA)) +
scale_color_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"=NA)) +
scale_y_continuous(labels = scales::label_scientific()) +
#scale_shape_manual(values = c("sample" = 0, "sampleCor" = 23, "pqc" = 22, "pqcCor" = 23, "ltr" = 22, "ltrCor" = 23)) +
ggtitle("data split per plate") +
theme(legend.position = "none")
combinedPlot <- cowplot::plot_grid(
ncol = 3,
rel_widths = c(0.35,0.15,(0.05 * pageWidth)),
ccPlot,
violinPlot,# NULL, nrow = 1, rel_widths = c(0.2,0.6,0.2)),
violinPlotplate
)
print(combinedPlot)
}
#load packages
package_list <- c('statTarget', 'svDialogs', 'ggpubr', 'janitor', 'mzR', 'cowplot', 'tidyverse', 'fedmatch','sva', 'gghalves')
for(idx_package in package_list){
if(length(which(row.names(installed.packages()) == idx_package)) > 0){
suppressMessages(require(package = idx_package,
character.only = TRUE))
} else {
svDialogs::dlg_message(
paste0("the package ", idx_package, " is not installed. Please install ", idx_package, " before continuing.")
)
}
}
if(!dir.exists(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/controlCharts/"))){
dir.create(paste0(master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/controlCharts/"))
}
#add a vairable that adapts page width for number of plates
pageWidth <- length(master_list$project_details$plateList)
#open pdf device
pdf(
onefile = TRUE, width = (15 + pageWidth), height = 10,
file = paste0(
master_list$project_details$project_dir, "/", master_list$project_details$wash, "/plots/controlCharts/", Sys.Date(), "_", master_list$project_details$project_name, "_SPE_", master_list$project_details$wash, "_all_metabolites_controlCharts.pdf"
)
)
idx_metabolite = "x3_haa"
for(idx_metabolite in (master_list$data$response$statTarget %>% bind_rows() %>% select(!contains("sample")) %>% names())){
# --------------------------------------------------------------
## Data preparatoion
# --------------------------------------------------------------
### for peak area
#extract SIL to plot
plotSIL <- master_list$templates$metaboliteNames$silUsed_statTarget[which(master_list$templates$metaboliteNames$newNames == idx_metabolite)]
#get janitor::tidyName
plotSIL <- master_list$templates$metaboliteNames$newNames[which(master_list$templates$metaboliteNames$oldNames == plotSIL)]
# get peak areas to plot
plotArea <- master_list$data$peakArea$imputed %>% bind_rows() %>%
select(sample_run_index, sample_name, sample_type, sample_plate, all_of(idx_metabolite), all_of(plotSIL)) %>%
setNames(c("sample_run_index", "sample_name", "sample_type", "sample_plate", "area", "silArea")) %>%
left_join(
.,
master_list$data$response$impute %>% bind_rows() %>%
select(sample_name, all_of(idx_metabolite)) %>% setNames(c("sample_name", "response")),
by = "sample_name"
)
#combine into plotArea
plotData <- plotArea %>%
filter(sample_type != "vltr") %>%
pivot_longer(
cols = c("area",
"silArea",
"response"),
names_to = "dataType",
values_to = "value"
)
pqcData = plotData %>%
filter(sample_type == "pqc")
#get median values
loopMedian =  pqcData %>%
group_by(dataType) %>%
summarize(median_val = median(value, na.rm = TRUE))
#loop mean
loopMean = pqcData %>%
group_by(dataType) %>%
summarize(mean_val = mean(value,  na.rm = TRUE))
#loop sd
loopSd = pqcData %>%
group_by(dataType) %>%
summarize(sd_val = sd(value,  na.rm = TRUE))
#loopRsd
loopRsd = loopSd %>%
select(dataType) %>%
add_column(
rsd_val = (loopSd$sd_val / loopMean$mean_val) *100
)
# get peak areas to plot
plotAreaCor <- master_list$data$peakArea$statTarget %>% bind_rows() %>%
select(sample_run_index, sample_name, sample_type, sample_plate, all_of(idx_metabolite), all_of(plotSIL)) %>%
setNames(c("sample_run_index", "sample_name", "sample_type", "sample_plate", "area", "silArea")) %>%
left_join(
by = "sample_name",
.,
master_list$data$response$statTarget %>% bind_rows() %>%
select(sample_name, all_of(idx_metabolite)) %>% setNames(c("sample_name", "response"))
)
#combine into plotArea
plotDataCor <- plotAreaCor %>%
filter(sample_type != "vltr") %>%
rename(areaCor = area, silAreaCor = silArea, responseCor = response) %>%
pivot_longer(
cols = c("areaCor",
"silAreaCor",
"responseCor"),
names_to = "dataType",
values_to = "value"
)  %>%
mutate(sample_type = paste0(sample_type, "Cor"))
pqcDataCor = plotDataCor %>%
filter(sample_type == "pqcCor")
#get median values
loopMedianCor =  pqcDataCor %>%
group_by(dataType) %>%
summarize(median_val = median(value, na.rm = TRUE))
#loop mean
loopMeanCor = pqcDataCor %>%
group_by(dataType) %>%
summarize(mean_val = mean(value,  na.rm = TRUE))
#loop sd
loopSdCor = pqcDataCor %>%
group_by(dataType) %>%
summarize(sd_val = sd(value,  na.rm = TRUE))
#loopRsd
loopRsdCor = loopSdCor %>%
select(dataType) %>%
add_column(
rsd_val = (loopSdCor$sd_val / loopMeanCor$mean_val) *100
)
#join data
plotDataALL <- bind_rows(
plotData,
plotDataCor
) %>%
mutate(sample_type = factor(sample_type, levels = c("sample", "sampleCor", "pqc", "pqcCor", "ltr", "ltrCor", "NA"), ordered = TRUE)) %>%
arrange(sample_name, dataType)
####--------------------
#add facets
####--------------------
#add facet column
plotDataALL[["facet"]] <- NA
#area
plotDataALL$facet[which(plotDataALL$dataType == "area")] <- paste0("1. area;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "area")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "areaCor")] %>% floor(), "%")
#areaCor
plotDataALL$facet[which(plotDataALL$dataType == "areaCor")] <- paste0("1. area;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "area")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "areaCor")] %>% floor(), "%")
#silArea
plotDataALL$facet[which(plotDataALL$dataType == "silArea")] <- paste0("2. silArea;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "silArea")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "silAreaCor")] %>% floor(), "%")
#silAreaCor
plotDataALL$facet[which(plotDataALL$dataType == "silAreaCor")] <- paste0("2. silArea;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "silArea")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "silAreaCor")] %>% floor(), "%")
#response
plotDataALL$facet[which(plotDataALL$dataType == "response")] <- paste0("3. response;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "response")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "responseCor")] %>% floor(), "%")
#responseCor
plotDataALL$facet[which(plotDataALL$dataType == "responseCor")] <- paste0("3. response;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "response")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "responseCor")] %>% floor(), "%")
#add facet for median PQC hline
loopMedian[["facet"]] <- NA
#area
loopMedian$facet[which(loopMedian$dataType == "area")] <- paste0("1. area;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "area")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "areaCor")] %>% floor(), "%")
#silArea
loopMedian$facet[which(loopMedian$dataType == "silArea")] <- paste0("2. silArea;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "silArea")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "silAreaCor")] %>% floor(), "%")
#response
loopMedian$facet[which(loopMedian$dataType == "response")] <- paste0("3. response;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "response")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "responseCor")] %>% floor(), "%")
#add facet for median PQC hline
loopMedianCor[["facet"]] <- NA
#area
loopMedianCor$facet[which(loopMedianCor$dataType == "areaCor")] <- paste0("1. area;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "area")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "areaCor")] %>% floor(), "%")
#silArea
loopMedianCor$facet[which(loopMedianCor$dataType == "silAreaCor")] <- paste0("2. silArea;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "silArea")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "silAreaCor")] %>% floor(), "%")
#response
loopMedianCor$facet[which(loopMedianCor$dataType == "responseCor")] <- paste0("3. response;\n", "PQC %RSD = ", loopRsd$rsd_val[which(loopRsd$dataType == "response")] %>% floor(), "%;\n corrected PQC %RSD = ", loopRsdCor$rsd_val[which(loopRsdCor$dataType == "responseCor")] %>% floor(), "%")
# --------------------------------------------------------------
## PLOT
# --------------------------------------------------------------
#set plot title
plotTitle <- paste0(
master_list$templates$metaboliteNames$tidyName[which(master_list$templates$metaboliteNames$newNames == idx_metabolite)],
"; SIL used =  ",
master_list$templates$metaboliteNames$tidyName[which(master_list$templates$metaboliteNames$newNames == plotSIL)],
"; matched SIL = ",
master_list$templates$metaboliteNames$matchedSilUsed[which(master_list$templates$metaboliteNames$newNames == idx_metabolite)]
)
#create plot
ccPlot <- ggplot(data = plotDataALL, aes(x = sample_run_index, y = value)) +
geom_point(data = plotDataALL %>% filter(grepl("sample", sample_type)), aes(colour = sample_type,fill = sample_type, shape = sample_type, size = sample_type)) +
geom_point(data = plotDataALL %>% filter(!grepl("sample", sample_type)), aes(colour = sample_type,fill = sample_type, shape = sample_type, size = sample_type)) +
theme_bw() +
scale_shape_manual(values = c("sample" = 0, "sampleCor" = 23, "pqc" = 22, "pqcCor" = 23, "ltr" = 22, "ltrCor" = 23)) +
scale_size_manual(values = c("sample" = 2, "sampleCor" = 2, "pqc" = 3, "pqcCor" = 3, "ltr" = 3, "ltrCor" = 3)) +
scale_color_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "black", "ltr" = "seagreen3", "ltrCor" = "black")) +
scale_fill_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = NA, "pqcCor" = "orchid", "ltr" = NA, "ltrCor" = "seagreen3")) +
geom_hline(data= loopMedian, aes(yintercept=median_val), colour = "orchid4", linetype ="dotted", linewidth = 1) +
geom_hline(data= loopMedianCor, aes(yintercept=median_val), colour = "orchid4", linetype ="solid", linewidth = .8) +
facet_wrap(facets = "facet", ncol = 1, scales = "free_y") +
scale_y_continuous(labels = scales::label_scientific()) +
ggtitle(plotTitle) +
theme(legend.position = "none")
####------------------------
## VIolin plots
####------------------------
violinData = plotDataALL %>%
#filter(dataType == "responseBatchCorrected" | dataType == "response") %>%
mutate(sample_plate = sub("a", "", sample_plate)) %>%
mutate(sample_plate = sub("b", "", sample_plate)) %>%
#add columns tio violinData
add_column(
side = ifelse(grepl("Cor", .$sample_type), "r", "l"),
sample_type_x = gsub("Cor", "", .$sample_type)
)
#add max/min dummy data to normalise axis on facet_wrap
for(idx_dataType in unique(violinData$dataType)){
#work around to normalise axis on per plate plot
maxValue <- violinData %>%
filter(dataType == idx_dataType) %>%
.$value %>%
max()
minValue <- violinData %>%
filter(dataType == idx_dataType) %>%
.$value %>%
min()
#make dummy data per plate for plot control
dummyData = list()
for(idx_plate in unique(violinData$sample_plate)){
dummyData <- dummyData %>%
bind_rows(.,
bind_rows(
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == maxValue))[1,],
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == minValue))[1,]
) %>% mutate(
sample_plate = idx_plate,
sample_run_index = NA)
)
} # idx plate\
for(idx_sampleType in unique(violinData$sample_type_x)){
dummyData <- dummyData %>%
bind_rows(.,
bind_rows(
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == maxValue))[1,],
(violinData %>%
filter(dataType == idx_dataType) %>%
filter(value == minValue))[1,]
) %>% mutate(
sample_type_x = idx_sampleType,
sample_run_index = NA)
)
} # idx sampleType
#add dummy data to violinData
violinData <- violinData %>%
bind_rows(.,
dummyData)
}
#change sample type for colour control
violinData$sample_type[is.na(violinData$sample_run_index)] <- "NA"
#mutate to factor
violinData <- violinData %>%
mutate(
sample_type_x = factor(sample_type_x, levels = c("pqc", "ltr", "sample", "NA"), ordered = TRUE),
sample_plate_idx = factor(sample_plate)
) %>%
mutate(
sample_plate_idx = as.integer(sample_plate_idx)
) %>%
mutate(
sample_plate_idx = as.factor(sample_plate_idx)
)
#make plot
violinPlot <- ggplot(data = violinData, aes(x = sample_type_x, y = value, fill = sample_type, color = sample_type)) +
theme_bw() +
# Split violin using gghalves
geom_half_violin(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0),
trim = TRUE, alpha = 1, scale = "width"
) +
geom_half_violin(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = 0),
trim = TRUE, alpha = 0.25, scale = "width"
) +
geom_hline(data= loopMedian, aes(yintercept=median_val), colour = "orchid1", linetype ="dotted", linewidth = 1) +
geom_hline(data= loopMedianCor, aes(yintercept=median_val), colour = "orchid4", linetype ="solid", linewidth = .8) +
geom_half_boxplot(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
geom_half_boxplot(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = -0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
facet_wrap(facets = c("facet"), ncol=1, scales="free_y") +
scale_fill_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"= NA)) +
scale_color_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"= NA)) +
scale_y_continuous(labels = scales::label_scientific()) +
#scale_shape_manual(values = c("sample" = 0, "sampleCor" = 23, "pqc" = 22, "pqcCor" = 23, "ltr" = 22, "ltrCor" = 23)) +
ggtitle("all plates") +
theme(legend.position = "none")
#make a plot per plate
violinPlotplate <- ggplot(data = violinData, aes(x = sample_plate_idx, y = value, fill = sample_type, color = sample_type)) +
theme_bw() +
# Split violin using gghalves
geom_half_violin(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0),
trim = TRUE, alpha = 1, scale = "width"
) +
geom_half_violin(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = 0),
trim = TRUE, alpha = 0.25, scale = "width"
) +
geom_hline(data= loopMedian, aes(yintercept=median_val), colour = "orchid1", linetype ="dotted", linewidth = 1, alpha = 1) +
geom_hline(data= loopMedianCor, aes(yintercept=median_val), colour = "orchid4", linetype ="solid", linewidth = .8, alpha = 1) +
geom_half_boxplot(
data = violinData %>% filter(grepl("Cor", sample_type)),
side = "r",
position = position_nudge(x = 0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
geom_half_boxplot(
data = violinData %>% filter(!grepl("Cor", sample_type)),
side = "l",
position = position_nudge(x = -0.1),
notch = FALSE, alpha = 1, outlier.shape = NA,
color = "grey30", fill = NA, center = TRUE, width = 0.25
) +
facet_wrap(facets = c("facet", "sample_type_x"), ncol = length(unique(violinData$sample_type_x)), scales = "free_y") +
scale_fill_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"=NA)) +
scale_color_manual(values = c("sample" = "grey", "sampleCor" = "grey", "pqc" = "orchid", "pqcCor" = "orchid", "ltr" = "seagreen3", "ltrCor" = "seagreen3", "NA"=NA)) +
scale_y_continuous(labels = scales::label_scientific()) +
#scale_shape_manual(values = c("sample" = 0, "sampleCor" = 23, "pqc" = 22, "pqcCor" = 23, "ltr" = 22, "ltrCor" = 23)) +
ggtitle("data split per plate") +
theme(legend.position = "none")
combinedPlot <- cowplot::plot_grid(
ncol = 3,
rel_widths = c(0.35,0.15,(0.05 * pageWidth)),
ccPlot,
violinPlot,# NULL, nrow = 1, rel_widths = c(0.2,0.6,0.2)),
violinPlotplate
)
print(combinedPlot)
}
dev.off()
